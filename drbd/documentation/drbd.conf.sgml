<!DOCTYPE RefEntry PUBLIC "-//Davenport//DTD DocBook V3.0//EN">
<refentry>
<docinfo><date>15 Apr 2001</date></docinfo>

<refmeta>
 <refentrytitle>drbd.conf</refentrytitle>
 <manvolnum>5</manvolnum>
</refmeta>

<refnamediv>
 <refname>drbd.conf</refname>
 <refpurpose>Configuration file for DRBD's devices</refpurpose>

</refnamediv>
<refsect1>
 <title>Introduction</title>
 <para>
The file <option>/etc/drbd.conf</option> is read by 
<option>/etc/init.d/drbd</option> and 
<option>/etc/ha.d/resource.d/datadisk</option> 
which are included in the DRBD distribution.
</para>
<para>
The file format was designed as to allow to have 
a verbatim copy of the file on both nodes of the cluster.
It is highly recommended to do so in order to keep your configuration
manageable.
<example>
<title>A small drbd.conf file</title>
<programlisting>
resource drbd0 {
  protocol=C
  fsckcmd=fsck.ext2 -p -y

  on thost1 {
    device=/dev/nb1
    disk=/dev/hda7
    address=10.1.1.31
    port=7789
  }

  on thost2 {
    device=/dev/nb1
    disk=/dev/hda7
    address=10.1.1.32
    port=7789
  }
}	
</programlisting>
</example>
In this example there is a single DRBD resource (called drbd0) which uses
protocol C for the connection between its devices. The application
of this resource is an ext2 file system, since the command to restart
it is <replaceable>fsck.ext2 -p -y</replaceable>.
The device which runs
on host <replaceable>thost1</replaceable> uses
<replaceable>/dev/nb1</replaceable> as devices for its application, and
<replaceable>/dev/hda7</replaceable> as low level storage for the data.
The IP addresses are used to specify the networking interfaces to use.
</para>
<para>
There may be multiple resource sections in a single drbd.conf file.
</para>
</refsect1>
<refsect1>
 <title>File Format</title>
  <para>
The file consists of sections and parameter lines. 
A section begins with a keyword, sometimes an additional name, and an 
opening brace.
A section ends with a closing brace.
</para>
<para>
A parameter line starts with the identifier of the parameter followed
by an equal sign (<quote>=</quote>). Every subsequent character on 
that line is considered
as part of the parameters value. White space surrounding the equal
sign is ignored. A special case are Boolean
parameters which only consist of the identifier.
</para>
<para>
Comment lines may be placed into the configuration file and must
begin with a hash sign (<quote>#</quote>) in the leftmost column.
  </para>
 <refsect2>
 <title>Sections</title>
<variablelist>
 <varlistentry>
  <term><option>global</option></term>
  <listitem><para>
    Configures some global parameters. Currently only
    minor_count=number and disable_io_hints are allowed
    here. You may only have one global section, preferably
    as the first section.
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>resource <replaceable>name</replaceable></option></term>
  <listitem><para>
    Configures a DRBD resource.
    Each resource section needs to have two host sections 
    (keyword <option>on</option>) and may have
    a <option>net</option> and a <option>disk</option> section.
    Required parameters in this section: <option>protocol</option>,
    <option>fsckcmd</option>. Optional parameters are <option>inittimeout
    </option>, <option>skip-wait</option>, <option>load-only</option>, and 
    <option>incon-degr-cmd</option>.
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>on <replaceable>host-name</replaceable></option></term>
  <listitem><para>
    Carries the necessary configuration parameters for a DRBD 
    device of the enclosing resource.
    Required parameters in this section: <option>device</option>,
    <option>disk</option>, <option>address</option>, <option>port</option>.
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>disk</option></term>
  <listitem><para>
    This section is used to fine tune DRBD's properties
    in respect to the low level storage. Please
    refer to <citerefentry><refentrytitle>drbdsetup</refentrytitle>
    <manvolnum>8</manvolnum></citerefentry> for detailed description of 
    the parameters.
    Allowed parameters: <option>disk-size</option>, <option>do-panic</option>.
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>net</option></term>
  <listitem><para>
    This section is used to fine tune DRBD's properties. Please
    refer to <citerefentry><refentrytitle>drbdsetup</refentrytitle>
    <manvolnum>8</manvolnum></citerefentry> for detailed description
    of this section's parameters.
    Allowed parameters: <option>sync-rate</option>, 
    <option>sync-max</option>, <option>sync-min</option>,
    <option>sync-nice</option>, <option>sync-group</option>, <option>skip-sync</option>,
    <option>connect-int</option>, <option>ping-int</option>,
    <option>timeout</option>, <option>tl-size</option>,
    <option>sndbuf-size</option>, <option>ko-count</option>.
  </para>
  </listitem>
</varlistentry>
</variablelist>
 </refsect2>
 <refsect2>
 <title>Parameter</title>

<variablelist>
 <varlistentry>
  <term><option>protocol=<replaceable>prot-id</replaceable></option></term>
  <listitem><para>
    <replaceable>prot-id</replaceable> may be A, B or C. 
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>fsckcmd=<replaceable>command</replaceable></option></term>
  <listitem><para>
    Upon resource takeover datadisk runs the 
    <replaceable>command</replaceable> on the device of the resource.
    Specify here the command that brings your file system into 
    a consistent state.
    In case of a journaling file system you may use 
    <replaceable>/bin/true</replaceable> instead.
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>inittimeout=<replaceable>value</replaceable></option></term>
  <listitem><para>
    If <replaceable>value</replaceable> is positive, and the other node does
    not show up within the specified time (seconds), this node will start the
    resource in degraded mode, read: forces primary status on this node.</para>
    <para>Only use this option if availability is more important to you than
    the consistency of your data.</para>
    <para>If <replaceable>value</replaceable> is negative, and the other node
    does not show up within the specified time (seconds), this node stays in
    WFConnection:Secondary/Unknown state, and just lets the boot process
    continue. Use this if you expect a reboot of the remaining node of a
    degraded cluster, and you think your clustermanager is able to handle this
    better.
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>skip-wait</option></term>
  <listitem><para>
    If you want startup of DRBD to proceed without waiting for 
    synchronisation to finish, you can set this option. WARNING:
    only do this if whatever software you're using to manage DRBD can 
    correctly handle a syncing DRBD device (no failover possible), or a cluster in
    degraded mode.
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>load-only</option></term>
  <listitem><para>
    If you want the resource script to load the
    configuration into the module ONLY, use this.
    It will not even wait for connection of the devices.
    WARNING: see above.
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>incon-degr-cmd=<replaceable>command</replaceable></option></term>
  <listitem><para>
    In case a node starts up in degraded mode (inittimeout is set) and
    its local replica of the data is inconsistent it executes the
    <replaceable>command</replaceable>. If the command exits without
    error, datadisk expects the DRBD device to be in primary state.
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>port=<replaceable>number</replaceable></option></term>
  <listitem><para>
    Each DRBD resource needs a TCP port <replaceable>number</replaceable> 
    which is used to connect to the node's partner device. 
    Two DRBD resources may not use the same port.
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>device=<replaceable>name</replaceable></option></term>
  <listitem><para>
    The name of the block device node of the resource being described.
    You must use this device with your application (file system) and 
    you must not use the block device which is specified with the 
    <option>disk=</option> parameter.
  </para>
  <para>
    The device nodes must have the same major number as the DRBD
    driver has. With the current implementation major 43 is used
    and the corresponding device nodes are usually named 
    <option>/dev/nb0</option>, <option>/dev/nb1</option>, etc.
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>disk=<replaceable>name</replaceable></option></term>
  <listitem><para>
    DRBD uses this block device to actually store and retrieve the data.
    Never access such a device while DRBD is running on top of it. This
    holds also true for <citerefentry><refentrytitle>dumpe2fs</refentrytitle>
    <manvolnum>8</manvolnum></citerefentry> and similar commands.
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>address=<replaceable>ip-addr</replaceable></option></term>
  <listitem><para>
    A resource needs one IP address per device, which is used to wait for 
    incoming connections from the partner device respectively to reach
    the partner device.
  </para>
  </listitem>
</varlistentry>

</variablelist>
</refsect2>
</refsect1>
<refsect1>
<title>Version</title>
<simpara>This document is correct for version 0.6.11 of the DRBD distribution.
</simpara>
</refsect1>
<refsect1>
<title>Author</title>
<simpara>Written by Philipp Reisner <email>philipp.reisner@gmx.at</email>.
</simpara>
</refsect1>
<refsect1>
<title>Reporting Bugs</title>
<simpara>Report bugs to <email>drbd-user@lists.linbit.com</email>.
</simpara>
</refsect1>
<refsect1>
<title>Copyright</title>
<simpara>
Copyright (c) 2001 Philipp Reisner. This  is  free software; 
see the source for copying conditions.  There is NO warranty; 
not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
</simpara>
</refsect1>
<refsect1>
<title>See Also</title>
<para>
    <citerefentry><refentrytitle>drbd</refentrytitle>
    <manvolnum>8</manvolnum></citerefentry>,
    <citerefentry><refentrytitle>datadisk</refentrytitle>
    <manvolnum>8</manvolnum></citerefentry>,
    <citerefentry><refentrytitle>drbdsetup</refentrytitle>
    <manvolnum>8</manvolnum></citerefentry>
</para>
</refsect1>
</refentry>






